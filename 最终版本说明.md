# 自动开发服务器启动工具 - 最终版本说明

## 🎉 版本信息
- **版本**: v1.0.1 Final
- **发布日期**: 2026-01-29
- **文件位置**: `release-final/win-unpacked/自动开发服务器启动工具.exe`
- **文件大小**: 约 203 MB

## ✨ 核心功能

### 1. 智能项目检测（无需配置文件）
- ✅ 自动读取 `package.json`
- ✅ 智能识别启动命令（dev > start > serve）
- ✅ 自动检测包管理器（pnpm > yarn > npm）
- ✅ 无需手动创建 `dev-config.json`

### 2. 自动依赖安装 🆕
- ✅ 启动前自动检查 `node_modules`
- ✅ 自动识别包管理器并安装依赖
- ✅ 实时显示安装进度
- ✅ 安装完成后自动启动项目

### 3. 智能进程管理 🆕
- ✅ 删除项目时自动停止服务器
- ✅ 关闭程序时自动停止所有服务器
- ✅ 避免留下孤立进程和端口占用

### 3. 智能进程管理 🆕
- ✅ 删除项目时自动停止服务器
- ✅ 关闭程序时自动停止所有服务器
- ✅ 避免留下孤立进程和端口占用

### 4. 项目管理
- ✅ 项目历史记录
- ✅ 一键启动/停止
- ✅ 实时服务器输出
- ✅ 状态可视化

### 5. 用户体验
- ✅ 现代化图形界面
- ✅ 文件夹选择器
- ✅ 友好的错误提示
- ✅ 窗口设置持久化
- ✅ **无菜单栏设计**（简洁界面）
- ✅ **URL 可点击**（输出中的链接可直接打开）

## 🚀 使用方法

### 快速开始
1. 运行 `自动开发服务器启动工具.exe`
2. 点击"📁 选择项目文件夹"
3. 选择包含 `package.json` 的项目文件夹
4. 应用自动检测配置并添加到历史
5. 点击"▶️ 启动"按钮
6. **如果缺少依赖，应用会自动安装**
7. 等待安装完成后，项目自动启动

### 自动依赖安装流程 🆕

当启动项目时，应用会：
1. 检查项目目录下是否存在 `node_modules`
2. 如果不存在，自动检测包管理器：
   - 检测到 `pnpm-lock.yaml` → 使用 pnpm
   - 检测到 `yarn.lock` → 使用 yarn
   - 检测到 `package-lock.json` → 使用 npm
   - 默认使用 npm
3. 执行 `install` 命令并实时显示进度
4. 安装完成后自动启动项目

**输出示例**：
```
检测到缺少 node_modules 目录，正在使用 pnpm 安装依赖...
执行命令: pnpm install

Packages: +399
++++++++++++++++++++++++++++++++++++++++++++
Progress: resolved 399, reused 399, downloaded 0, added 399, done

✓ 依赖安装完成，开始启动项目...

> my-project@1.0.0 dev
> vite

  VITE v5.0.0  ready in 500 ms
  ➜  Local:   http://localhost:5173/
```

### 自动检测规则

#### 启动命令优先级
1. `dev` - 如果 package.json 中有 `"dev": "..."` 脚本
2. `start` - 如果有 `"start": "..."` 脚本
3. `serve` - 如果有 `"serve": "..."` 脚本

#### 包管理器检测
- 存在 `pnpm-lock.yaml` → 使用 **pnpm**
- 存在 `yarn.lock` → 使用 **yarn**
- 否则 → 使用 **npm**

### 示例

假设你的项目 `package.json` 包含：
```json
{
  "name": "my-project",
  "scripts": {
    "dev": "vite",
    "build": "vite build"
  }
}
```

应用会自动生成配置：
- **命令**: `pnpm run dev`（如果检测到 pnpm-lock.yaml）
- **工作目录**: 项目文件夹路径
- **项目名称**: my-project

## 🐛 已修复的问题

### v1.0.1 新增修复 🆕

#### 1. 自动依赖安装 ✅
- **问题**: 项目缺少 node_modules 时启动失败
- **解决**: 自动检测并安装依赖，实时显示进度

#### 2. 删除项目时未停止服务器 ✅
- **问题**: 删除运行中的项目可能留下孤立进程
- **解决**: 删除前自动检查并停止服务器

#### 3. 关闭程序时进程未清理 ✅
- **问题**: 关闭应用后可能留下后台进程占用端口
- **解决**: 关闭前自动停止所有服务器并等待清理完成

### v1.0.0 修复

#### 1. 界面空白问题 ✅
- **原因**: preload 脚本导入了外部模块，在 ASAR 打包后路径错误
- **解决**: 移除外部依赖，直接在 preload 中定义常量

#### 2. 配置文件强制要求 ✅
- **原因**: 原设计要求必须有 dev-config.json
- **解决**: 实现自动检测 package.json 并生成配置

#### 3. 错误提示不友好 ✅
- **原因**: 错误消息过于技术化
- **解决**: 改进错误提示，说明需要 package.json

#### 4. 输出日志乱码 ✅
- **原因**: ANSI 颜色代码（如 `[32m`、`[1m`）未被处理
- **解决**: 使用正则表达式移除 ANSI 代码

#### 5. 停止按钮无效 ✅
- **原因**: Windows 上 SIGTERM 信号不起作用
- **解决**: 使用 `taskkill /T /F` 杀死整个进程树

#### 6. 顶部菜单栏显示 ✅
- **原因**: Electron 默认显示菜单栏
- **解决**: 设置 `autoHideMenuBar: true` 和 `setMenuBarVisibility(false)`

#### 7. URL 无法点击 ✅
- **原因**: 输出中的 URL 只是纯文本
- **解决**: 自动检测 URL 并转换为可点击链接，点击后在浏览器中打开

#### 8. 界面空白（缺少函数） ✅
- **原因**: App.tsx 中使用了 `getStatusColor` 函数但未定义
- **解决**: 添加 `getStatusColor` 函数返回状态对应的颜色

## 📁 项目结构

```
release-final/
└── win-unpacked/
    ├── 自动开发服务器启动工具.exe  ← 主程序
    ├── resources/
    │   └── app.asar                  ← 应用代码
    ├── locales/                      ← 语言文件
    └── *.dll                         ← 运行时库
```

## 🔧 高级用法

### 使用自定义配置（可选）

如果需要更精细的控制，仍然可以创建 `dev-config.json`：

```json
{
  "name": "我的项目",
  "command": "pnpm run dev",
  "cwd": "/path/to/project",
  "env": {
    "NODE_ENV": "development",
    "PORT": "3000"
  }
}
```

应用会优先使用 `dev-config.json`，如果不存在才会自动检测 `package.json`。

## 📊 支持的项目类型

- ✅ Vite 项目
- ✅ Vue CLI 项目
- ✅ React (Create React App)
- ✅ Next.js 项目
- ✅ Nuxt.js 项目
- ✅ Express 服务器
- ✅ 任何包含 package.json 的 Node.js 项目

## ⚠️ 注意事项

1. **package.json 必需**: 项目文件夹必须包含 `package.json` 文件
2. **启动脚本**: package.json 中必须有 `dev`、`start` 或 `serve` 脚本之一
3. **包管理器**: 确保系统已安装对应的包管理器（npm/yarn/pnpm）
4. **依赖安装**: 如果缺少 `node_modules`，应用会自动安装（首次可能需要较长时间）
5. **网络连接**: 自动安装依赖需要良好的网络连接

## 🎯 常见问题

### Q: 项目没有 node_modules，可以直接启动吗？
A: 可以！应用会自动检测并安装依赖：
1. 检测项目使用的包管理器（pnpm/yarn/npm）
2. 自动执行 install 命令
3. 实时显示安装进度
4. 安装完成后自动启动项目

### Q: 为什么提示"未找到 package.json"？
A: 请确保选择的文件夹是项目根目录，且包含 `package.json` 文件。

### Q: 启动失败怎么办？
A: 
1. 检查 package.json 中是否有启动脚本
2. 如果缺少依赖，应用会自动安装
3. 查看右侧输出面板的错误信息
4. 确保网络连接正常（用于下载依赖）

### Q: 可以同时启动多个项目吗？
A: 可以！每个项目都是独立的进程。

### Q: 关闭应用后服务器会停止吗？
A: 会的。应用关闭时会自动停止所有正在运行的服务器，确保不会留下后台进程。

### Q: 删除项目时会停止服务器吗？
A: 会的。删除项目前会自动检查并停止正在运行的服务器，避免留下孤立进程。

### Q: 依赖安装需要多长时间？
A: 取决于项目大小和网络速度，通常 1-5 分钟。安装进度会实时显示在输出窗口中。

## 📝 更新日志

### v1.0.1 (2026-01-29)
- 🆕 **自动依赖安装**: 启动前自动检查并安装缺失的依赖
- 🆕 **智能进程管理**: 删除项目和关闭程序时自动停止服务器
- ✅ 修复缺少依赖时启动失败的问题
- ✅ 修复删除运行中项目可能留下进程的问题
- ✅ 修复关闭程序时进程未清理的问题
- 📚 更新所有文档说明

### v1.0.0 Final (2026-01-29)
- ✅ 修复界面空白问题（preload 依赖 + 缺少函数）
- ✅ 实现自动检测 package.json
- ✅ 移除配置文件强制要求
- ✅ 改进错误提示
- ✅ 修复输出乱码（移除 ANSI 代码）
- ✅ 修复停止按钮无效（使用 taskkill）
- ✅ 移除顶部菜单栏
- ✅ 实现 URL 可点击功能
- ✅ 优化用户体验

## 🙏 感谢使用

如有问题或建议，欢迎反馈！
